{"ast":null,"code":"import _regeneratorRuntime from\"/Users/whl/ironhack/dating-apes/\\u6700\\u65B0/dating-apes/client/node_modules/@babel/runtime/helpers/esm/regeneratorRuntime.js\";import _asyncToGenerator from\"/Users/whl/ironhack/dating-apes/\\u6700\\u65B0/dating-apes/client/node_modules/@babel/runtime/helpers/esm/asyncToGenerator.js\";import _slicedToArray from\"/Users/whl/ironhack/dating-apes/\\u6700\\u65B0/dating-apes/client/node_modules/@babel/runtime/helpers/esm/slicedToArray.js\";import React,{useState,useEffect}from'react';import axios from'axios';import{jsx as _jsx}from\"react/jsx-runtime\";var AuthContext=/*#__PURE__*/React.createContext();function AuthProviderWrapper(props){var _useState=useState(false),_useState2=_slicedToArray(_useState,2),isLoggedIn=_useState2[0],setIsLoggedIn=_useState2[1];var _useState3=useState(true),_useState4=_slicedToArray(_useState3,2),isLoading=_useState4[0],setIsLoading=_useState4[1];var _useState5=useState(null),_useState6=_slicedToArray(_useState5,2),user=_useState6[0],setUser=_useState6[1];var storeToken=function storeToken(token){localStorage.setItem('authToken',token);};var verifyStoredToken=/*#__PURE__*/function(){var _ref=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime().mark(function _callee(){var storedToken,response,_user;return _regeneratorRuntime().wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:_context.prev=0;storedToken=localStorage.getItem('authToken');if(!storedToken){_context.next=11;break;}_context.next=5;return axios.get(\"/auth/verify\",{headers:{Authorization:\"Bearer \".concat(storedToken)}});case 5:response=_context.sent;_user=response.data;setUser(_user);setIsLoggedIn(true);_context.next=13;break;case 11:setUser(null);setIsLoggedIn(false);case 13:_context.next=20;break;case 15:_context.prev=15;_context.t0=_context[\"catch\"](0);console.error(_context.t0);setUser(null);setIsLoggedIn(false);case 20:_context.prev=20;setIsLoading(false);return _context.finish(20);case 23:case\"end\":return _context.stop();}}},_callee,null,[[0,15,20,23]]);}));return function verifyStoredToken(){return _ref.apply(this,arguments);};}();var removeToken=function removeToken(){localStorage.removeItem('authToken');};var logOutUser=function logOutUser(){removeToken();verifyStoredToken();};useEffect(function(){verifyStoredToken();},[]);return/*#__PURE__*/_jsx(AuthContext.Provider,{value:{isLoggedIn:isLoggedIn,isLoading:isLoading,user:user,storeToken:storeToken,verifyStoredToken:verifyStoredToken,logOutUser:logOutUser},children:props.children});}export{AuthProviderWrapper,AuthContext};","map":{"version":3,"names":["React","useState","useEffect","axios","AuthContext","createContext","AuthProviderWrapper","props","isLoggedIn","setIsLoggedIn","isLoading","setIsLoading","user","setUser","storeToken","token","localStorage","setItem","verifyStoredToken","storedToken","getItem","get","headers","Authorization","response","data","console","error","removeToken","removeItem","logOutUser","children"],"sources":["/Users/whl/ironhack/dating-apes/最新/dating-apes/client/src/context/auth.context.js"],"sourcesContent":["import React, { useState, useEffect } from 'react';\nimport axios from 'axios';\n\nconst AuthContext = React.createContext();\n\nfunction AuthProviderWrapper(props) {\n  const [isLoggedIn, setIsLoggedIn] = useState(false);\n  const [isLoading, setIsLoading] = useState(true);\n  const [user, setUser] = useState(null);\n  const storeToken = (token) => {\n    localStorage.setItem('authToken', token);\n  };\n\n  const verifyStoredToken = async () => {\n    try {\n      const storedToken = localStorage.getItem('authToken');\n      if (storedToken) {\n        const response = await axios.get(`/auth/verify`, { headers: { Authorization: `Bearer ${storedToken}` } });\n        const user = response.data;\n        setUser(user);\n        setIsLoggedIn(true);\n      }\n      else {\n        setUser(null);\n        setIsLoggedIn(false);\n      }\n    } catch (error) {\n      console.error(error);\n      setUser(null);\n      setIsLoggedIn(false);\n    } finally {\n      setIsLoading(false);\n    }\n  };\n\n\n  const removeToken = () => {\n    localStorage.removeItem('authToken');\n  };\n\n  const logOutUser = () => {\n    removeToken();\n    verifyStoredToken();\n  };\n\n  useEffect(() => {\n    verifyStoredToken();\n  }, []);\n\n  return (\n    <AuthContext.Provider value={{ isLoggedIn, isLoading, user, storeToken, verifyStoredToken, logOutUser }}>{props.children}</AuthContext.Provider>\n  );\n}\n\nexport { AuthProviderWrapper, AuthContext };\n"],"mappings":"+cAAA,MAAOA,MAAP,EAAgBC,QAAhB,CAA0BC,SAA1B,KAA2C,OAA3C,CACA,MAAOC,MAAP,KAAkB,OAAlB,C,2CAEA,GAAMC,YAAW,cAAGJ,KAAK,CAACK,aAAN,EAApB,CAEA,QAASC,oBAAT,CAA6BC,KAA7B,CAAoC,CAClC,cAAoCN,QAAQ,CAAC,KAAD,CAA5C,wCAAOO,UAAP,eAAmBC,aAAnB,eACA,eAAkCR,QAAQ,CAAC,IAAD,CAA1C,yCAAOS,SAAP,eAAkBC,YAAlB,eACA,eAAwBV,QAAQ,CAAC,IAAD,CAAhC,yCAAOW,IAAP,eAAaC,OAAb,eACA,GAAMC,WAAU,CAAG,QAAbA,WAAa,CAACC,KAAD,CAAW,CAC5BC,YAAY,CAACC,OAAb,CAAqB,WAArB,CAAkCF,KAAlC,EACD,CAFD,CAIA,GAAMG,kBAAiB,4FAAG,oLAEhBC,WAFgB,CAEFH,YAAY,CAACI,OAAb,CAAqB,WAArB,CAFE,KAGlBD,WAHkB,gDAIGhB,MAAK,CAACkB,GAAN,gBAA0B,CAAEC,OAAO,CAAE,CAAEC,aAAa,kBAAYJ,WAAZ,CAAf,CAAX,CAA1B,CAJH,QAIdK,QAJc,eAKdZ,KALc,CAKPY,QAAQ,CAACC,IALF,CAMpBZ,OAAO,CAACD,KAAD,CAAP,CACAH,aAAa,CAAC,IAAD,CAAb,CAPoB,+BAUpBI,OAAO,CAAC,IAAD,CAAP,CACAJ,aAAa,CAAC,KAAD,CAAb,CAXoB,yFActBiB,OAAO,CAACC,KAAR,cACAd,OAAO,CAAC,IAAD,CAAP,CACAJ,aAAa,CAAC,KAAD,CAAb,CAhBsB,yBAkBtBE,YAAY,CAAC,KAAD,CAAZ,CAlBsB,sGAAH,kBAAjBO,kBAAiB,0CAAvB,CAuBA,GAAMU,YAAW,CAAG,QAAdA,YAAc,EAAM,CACxBZ,YAAY,CAACa,UAAb,CAAwB,WAAxB,EACD,CAFD,CAIA,GAAMC,WAAU,CAAG,QAAbA,WAAa,EAAM,CACvBF,WAAW,GACXV,iBAAiB,GAClB,CAHD,CAKAhB,SAAS,CAAC,UAAM,CACdgB,iBAAiB,GAClB,CAFQ,CAEN,EAFM,CAAT,CAIA,mBACE,KAAC,WAAD,CAAa,QAAb,EAAsB,KAAK,CAAE,CAAEV,UAAU,CAAVA,UAAF,CAAcE,SAAS,CAATA,SAAd,CAAyBE,IAAI,CAAJA,IAAzB,CAA+BE,UAAU,CAAVA,UAA/B,CAA2CI,iBAAiB,CAAjBA,iBAA3C,CAA8DY,UAAU,CAAVA,UAA9D,CAA7B,UAA0GvB,KAAK,CAACwB,QAAhH,EADF,CAGD,CAED,OAASzB,mBAAT,CAA8BF,WAA9B"},"metadata":{},"sourceType":"module"}